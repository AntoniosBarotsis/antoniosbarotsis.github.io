<!DOCTYPE html>


<script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_OsZHF9H7fUX08AyjtqACUFVfnsQNWfKYkDy9tl0i0bG',{api_host:'https://app.posthog.com'})
</script>



<html lang="en">
<link rel="stylesheet" href="https://antoniosbarotsis.github.io/index.css">

<head>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js" integrity="sha512-LQNxIMR5rXv7o+b1l8+N1EZMfhG7iFZ9HhnbJkTp4zjNr5Wvst75AqUeFDxeRUa7l5vEDyUiAip//r+EFLLCyA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/mathtex-script-type.min.js" integrity="sha512-MBhOGY4yRA2eATtRGTcrDJCRqcnLai5+uu47GA2ueVr1MPzirC/iogLWRA8CXTlOTK09VI4fdTe4qE4LBfjsHw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js" integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->

    <title>Rewriting it in Rust</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://antoniosbarotsis.github.io/style.css">
    <link rel="stylesheet" href="https://antoniosbarotsis.github.io/color/orange-auto.css">

        <link rel="stylesheet" href="https://antoniosbarotsis.github.io/color/background_orange.css">
    
    <link rel="stylesheet" href="https://antoniosbarotsis.github.io/font-hack-subset.css">

    
    <meta name="description" content="Like the joke but for real this time.">

    <meta property="og:description" content="Like the joke but for real this time.">
    <meta property="og:title" content="Rewriting it in Rust">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="Like the joke but for real this time.">
    <meta name="twitter:title" content="Rewriting it in Rust">
    <meta property="twitter:domain" content="antoniosbarotsis.github.io">
    <meta property="twitter:url" content="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/">

        <link rel="shortcut icon" type="image&#x2F;x-icon" href="/favicon.ico">
    
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://antoniosbarotsis.github.io" style="text-decoration: none;">
                    <div class="logo">
                      
                            Tony&#x27;s Blog
                        
                    </div>
                </a>
            </div>
        </div>

        
        <nav class="menu">
            <ul class="menu__inner">
                <li><a href="https://antoniosbarotsis.github.io">Home</a></li>
            
                <li class="active"><a href="https://antoniosbarotsis.github.io/posts">Posts</a></li>
            
                <li><a href="https://antoniosbarotsis.github.io/tags">Tags</a></li>
            
                <li><a href="https://antoniosbarotsis.github.io/about">About</a></li>
            
                <li><a href="https://github.com/AntoniosBarotsis" target="_blank" rel="noopener noreferrer">Github</a></li>
            
                <li><a href="https://twitter.com/Tony_Barotsis" target="_blank" rel="noopener noreferrer">Twitter</a></li>
            
                <li><a href="https://www.linkedin.com/in/antonios-barotsis-5a26a0199/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li>
            
                <li><a href="mailto:antonios.barotsis@proton.me" target="_blank" rel="noopener noreferrer">Email</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
<h1 class="post-title"><a href="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/">Rewriting it in Rust</a></h1>
<div class="post-meta-inline">
    
    
<span class="post-date">
    2023-12-31
    </span>
 :: 7 min read ::
    
    


<a href="https://github.com/AntoniosBarotsis/antoniosbarotsis.github.io/blob/master/content/posts/rewrite_cs_in_rust.md">View
    Source</a>


&nbsp;
</div>


<span class="post-tags-inline">
    <a class="post-tag" href="https://antoniosbarotsis.github.io/tags/coding/">#Coding</a>,
    <a class="post-tag" href="https://antoniosbarotsis.github.io/tags/rust/">#Rust</a></span>


        

<meta name="keywords" content="Antonios,Barotsis,Tony,Portfolio,Blog,Open,Source,Rust" />


<!-- /posts -->
<div class="post-content">
    

<h2>Table of Contents</h2>
<ul>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/#introduction">Introduction</a>
        
    </li>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/#what-did-the-project-look-like">What did the project look like?</a>
        
    </li>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/#what-did-i-dislike-about-the-old-implementation">What did I dislike about the old implementation?</a>
        
        <ul>
            
            <li>
                <a href="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/#a-small-tangent-me-ranting">A small tangent (me ranting)</a>
            </li>
            
        </ul>
        
    </li>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/#the-main-problem">The main problem</a>
        
    </li>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/#so-how-did-the-rewrite-go">So how did the rewrite go?</a>
        
    </li>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/rewrite_cs_in_rust/#closing-thoughts">Closing thoughts</a>
        
    </li>
    
</ul>


    <h2 id="introduction"><a class="anchor" href="#introduction" aria-label="Anchor link for: introduction">Introduction</a></h2>
<p>A few years ago I worked on a notification service that would get upcoming appointments scheduled in
<a href="https://www.microsoft.com/en-us/microsoft-365/business/scheduling-and-booking-app">Microsoft Bookings</a>
and send a text message reminder to the person who made the appointment a few days prior.
This was in an effort to reduce the amount of appointments that were cancelled too late for a new
one to be booked in their place as well as make it less likely for people to forget about their
appointment altogether. This was not too hard to make and it worked wonders! I recently ended up
rewriting it in Rust over two afternoons and I ended up reflecting on a few things that I found
myself wanting to write about so here we are!</p>
<blockquote>
<p>As a small note, I don't think I'll have too many useful things in here, mostly just my hindsight
thoughts about stuff. I just haven't written anything in a while and wanted to get back into
it again.</p>
</blockquote>
<h2 id="what-did-the-project-look-like"><a class="anchor" href="#what-did-the-project-look-like" aria-label="Anchor link for: what-did-the-project-look-like">What did the project look like?</a></h2>
<p>The project was using AWS <a href="https://aws.amazon.com/lambda/">Lambda</a> for hosting,
<a href="https://docs.aws.amazon.com/sns/latest/dg/welcome.html">SNS</a> for sending text messages and
<a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html">SM's parameter store</a>
for storing an encrypted refresh token.</p>
<p>The appointment data was grabbed from
<a href="https://learn.microsoft.com/en-us/graph/use-the-api">Microsoft's Graph API</a> which also meant
configuring some stuff on
<a href="https://azure.microsoft.com/en-us/products/active-directory-ds">Azure Active Directory</a>.</p>
<h2 id="what-did-i-dislike-about-the-old-implementation"><a class="anchor" href="#what-did-i-dislike-about-the-old-implementation" aria-label="Anchor link for: what-did-i-dislike-about-the-old-implementation">What did I dislike about the old implementation?</a></h2>
<p>As I mentioned though, I worked on this about two years ago and while that may not sound like much,
it feels like quite a long time ago if you were relatively new to programming at the time. I've since
changed the way I write code quite a bit and if you do not actively dislike code you wrote that long
ago you have got to be doing something wrong!</p>
<p>For starters, it was written in C# which I have not really used at all since and even though it is
a "simple" language, I would much rather have it written in something I actively use today.</p>
<p>As you may have noticed, there are <em>a lot</em> of working parts and services involved in this project
(or at least for me, I don't know if this is more common to anyone reading this!), this means
handling a lot of potential errors even if my code does not actually do all that much. This was an
absolute breeze in Rust with its <code>Result</code>s and <code>Option</code>s while in C# I got caught off guard more than
once with something blowing up in production because it was not always obvious when something
might or might not explode.</p>
<p>A lot of the tooling I used was simply <em>a lot</em> less convenient than what I am used to in Rust,
talking specifically about dates and JSON (de)serialization. Now, I am not saying that both of these
are necessarily substantially better in Rust, but they <em>are</em> better than the ones I used. I simply
do not use C# enough to know the best tools for these things, there may have been (or since developed)
way better libraries, I just don't know about them. Rust's
<a href="https://crates.io/crates/serde_json"><code>serde_json</code></a> is great and
<a href="https://crates.io/crates/chrono"><code>chrono</code></a> is simply fantastic. I cannot stress how great it is to
express timezones in the type system, saved me so many headaches.</p>
<p>To run my code locally I had to use
<a href="https://www.nuget.org/packages/Amazon.Lambda.TestTool-6.0/">some official command line app</a>
that was just annoying to use. I understand it is in preview but it has been in preview since at
least 2 years ago and it looks the same as it did back then. When I switched to Rust I used
<a href="https://www.cargo-lambda.info"><code>cargo lamnda</code></a> which was a lot better.</p>
<h3 id="a-small-tangent-me-ranting"><a class="anchor" href="#a-small-tangent-me-ranting" aria-label="Anchor link for: a-small-tangent-me-ranting">A small tangent (me ranting)</a></h3>
<blockquote>
<p><em>"But C# has added those cool nullable <code>T?</code> types that effectively function as Rust's options,
what is so different with them that you can't handle them!"</em></p>
</blockquote>
<p>Excellent question! Well, since this C# feature, now also present in most other similar languages
I can think of actually, is more of an afterthought;</p>
<ul>
<li>it did not exist in the language originally, this means that a lot of code was written <em>before</em>
this was even added so it could not have been used.</li>
<li>since backwards compatibility is a thing, nothing is stopping anyone from declaring a type as
"non-nullable" (ie, <code>T</code> instead of <code>T?</code>) and then simply setting it to null at some point.
This is a fundamental problem with these languages that I can't see how it could be remedied.
So while seeing <code>T?</code> in signatures is convenient, you might as well treat all <code>T</code>s as nullable
as well which kind of defeats the purpose.</li>
</ul>
<p>And of course exceptions, unlike <code>Result</code>s, are not always obvious that they can be thrown.
Sometimes they are mentioned in the docs, sometimes they are not, especially when they are deeply
nested ¯\_(ツ)_/¯</p>
<h2 id="the-main-problem"><a class="anchor" href="#the-main-problem" aria-label="Anchor link for: the-main-problem">The main problem</a></h2>
<p>My main issue was really just <em>how</em> I wrote the code, regardless of whatever tooling I used. At the
time, a bunch of "clean code" and enterprise-style Java was fresh in my mind from university
courses and projects so you can bet I was dependency injecting absolutely everything. I was not
quite at the level of abstract factory builder factories but I had my fair share of unnecessary
abstractions.</p>
<p>This was in retrospect a great decision because I really got to see how terrible that type of code
can often be, especially when you need to work on it for a few years. The mental complexity of
everything was so high I had to spend a few minutes each time I wanted to make a small change just
to remember where each service and interface was located. Debugging was even worse because of this.</p>
<p>I don't exactly regret it per se because I remember that at the time I wanted to learn more about
that style of programming and I intentionally included a bunch of those ideas in my codebase. Had I
not done this, who knows, I could still be advocating for "clean code", instead I lived to tell the
tale.</p>
<h2 id="so-how-did-the-rewrite-go"><a class="anchor" href="#so-how-did-the-rewrite-go" aria-label="Anchor link for: so-how-did-the-rewrite-go">So how did the rewrite go?</a></h2>
<p>It was pretty smooth actually but as I said, the code that I had to write in the end was not that
much. Plus, the second time you do anything is significantly easier than the first so no surprises
there. I ended up with about ~500 lines of code in the end but that included some new functionality
that took about 100 lines, as I said it was <em>really</em> not that much. Still about half of my original
code though so that's always a nice thing to see.</p>
<p>I am quite happy with the DX improvements, especially the local environment and deployment speeds.
Ending up with a 6mb zipped binary is definitely helping that over the 400mb Docker image I had
previously!</p>
<h2 id="closing-thoughts"><a class="anchor" href="#closing-thoughts" aria-label="Anchor link for: closing-thoughts">Closing thoughts</a></h2>
<p>Would I do it again? Probably.</p>
<p>Although I don't think I will ever really like these very "managed" environments like AWS Lambda.
They work fine and all but I really just like having a normal project I can just run from my
terminal with no instrumentation required. Lambda is often too convenient unfortunately so there's
that I guess.</p>
<p>But anyway, that was fun nonetheless.</p>
<p>Till next time!</p>

</div>

        
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read more</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        <span class="button previous">
            <a href="https://antoniosbarotsis.github.io/posts/2023-recapped/">
                <span class="button__icon">←</span>&nbsp;
                <span class="button__text">2023-recapped</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://antoniosbarotsis.github.io/posts/simple_rust_macros/">
                <span class="button__text">Simple Rust Function Macros</span>&nbsp;
                <span class="button__icon">→</span>
            </a>
        </span>
        </div>
</div>

<script src="https://utteranc.es/client.js" repo="AntoniosBarotsis/antoniosbarotsis.github.io" issue-term="pathname"
    label="Comment" theme="github-dark" crossorigin="anonymous" async>
    </script>


    </div>


    </div>
    
    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2025
 Powered by <a href="https://www.getzola.org/">Zola</a></span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
