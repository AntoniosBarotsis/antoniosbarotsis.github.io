<!DOCTYPE html>


<script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_OsZHF9H7fUX08AyjtqACUFVfnsQNWfKYkDy9tl0i0bG',{api_host:'https://app.posthog.com'})
</script>



<html lang="en">
<link rel="stylesheet" href="https://antoniosbarotsis.github.io/index.css">

<head>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js" integrity="sha512-LQNxIMR5rXv7o+b1l8+N1EZMfhG7iFZ9HhnbJkTp4zjNr5Wvst75AqUeFDxeRUa7l5vEDyUiAip//r+EFLLCyA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/mathtex-script-type.min.js" integrity="sha512-MBhOGY4yRA2eATtRGTcrDJCRqcnLai5+uu47GA2ueVr1MPzirC/iogLWRA8CXTlOTK09VI4fdTe4qE4LBfjsHw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js" integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->

    <title>Testing an ASP .NET Core project</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://antoniosbarotsis.github.io/style.css">
    <link rel="stylesheet" href="https://antoniosbarotsis.github.io/color/orange-auto.css">

        <link rel="stylesheet" href="https://antoniosbarotsis.github.io/color/background_orange.css">
    
    <link rel="stylesheet" href="https://antoniosbarotsis.github.io/font-hack-subset.css">

    
    <meta name="description" content="Tests and automated coverage reports with .NET and Github actions.">

    <meta property="og:description" content="Tests and automated coverage reports with .NET and Github actions.">
    <meta property="og:title" content="Testing an ASP .NET Core project">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://antoniosbarotsis.github.io/posts/aspnet_testing/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="Tests and automated coverage reports with .NET and Github actions.">
    <meta name="twitter:title" content="Testing an ASP .NET Core project">
    <meta property="twitter:domain" content="antoniosbarotsis.github.io">
    <meta property="twitter:url" content="https://antoniosbarotsis.github.io/posts/aspnet_testing/">

        <link rel="shortcut icon" type="image&#x2F;x-icon" href="/favicon.ico">
    
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://antoniosbarotsis.github.io" style="text-decoration: none;">
                    <div class="logo">
                      
                            Tony&#x27;s Blog
                        
                    </div>
                </a>
            </div>
        </div>

        
        <nav class="menu">
            <ul class="menu__inner">
                <li><a href="https://antoniosbarotsis.github.io">Home</a></li>
            
                <li class="active"><a href="https://antoniosbarotsis.github.io/posts">Posts</a></li>
            
                <li><a href="https://antoniosbarotsis.github.io/tags">Tags</a></li>
            
                <li><a href="https://antoniosbarotsis.github.io/about">About</a></li>
            
                <li><a href="https://github.com/AntoniosBarotsis" target="_blank" rel="noopener noreferrer">Github</a></li>
            
                <li><a href="https://twitter.com/Tony_Barotsis" target="_blank" rel="noopener noreferrer">Twitter</a></li>
            
                <li><a href="https://www.linkedin.com/in/antonios-barotsis-5a26a0199/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li>
            
                <li><a href="mailto:antonios.barotsis@proton.me" target="_blank" rel="noopener noreferrer">Email</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
<h1 class="post-title"><a href="https://antoniosbarotsis.github.io/posts/aspnet_testing/">Testing an ASP .NET Core project</a></h1>
<div class="post-meta-inline">
    
    
<span class="post-date">
    2021-10-29
    </span>
 :: 6 min read ::
    
    


<a href="https://github.com/AntoniosBarotsis/antoniosbarotsis.github.io/blob/master/content/posts/aspnet_testing.md">View
    Source</a>


&nbsp;
</div>


<span class="post-tags-inline">
    <a class="post-tag" href="https://antoniosbarotsis.github.io/tags/coding/">#Coding</a>,
    <a class="post-tag" href="https://antoniosbarotsis.github.io/tags/csharp/">#Csharp</a></span>


        

<meta name="keywords" content="Antonios,Barotsis,Tony,Portfolio,Blog,Open,Source,Rust" />


<!-- /posts -->
<div class="post-content">
    

<h2>Table of Contents</h2>
<ul>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/aspnet_testing/#introduction">Introduction</a>
        
    </li>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/aspnet_testing/#coding">Coding</a>
        
        <ul>
            
            <li>
                <a href="https://antoniosbarotsis.github.io/posts/aspnet_testing/#creating-the-project">Creating the project</a>
            </li>
            
            <li>
                <a href="https://antoniosbarotsis.github.io/posts/aspnet_testing/#creating-the-service">Creating the service</a>
            </li>
            
            <li>
                <a href="https://antoniosbarotsis.github.io/posts/aspnet_testing/#writing-our-tests">Writing our tests</a>
            </li>
            
            <li>
                <a href="https://antoniosbarotsis.github.io/posts/aspnet_testing/#adding-a-ci-pipeline-with-codecov">Adding a CI pipeline with Codecov</a>
            </li>
            
        </ul>
        
    </li>
    
    <li>
        <a href="https://antoniosbarotsis.github.io/posts/aspnet_testing/#conclusion">Conclusion</a>
        
    </li>
    
</ul>


    <h2 id="introduction"><a class="anchor" href="#introduction" aria-label="Anchor link for: introduction">Introduction</a></h2>
<p>Most Web API templates I could find online do not have testing pre configured in them and the official ones do not have it at all so I thought
that I would make a post about setting up basic unit tests as well as mocking dependencies.</p>
<p>I will be using <a href="https://xunit.net/">XUnit</a> which is one of the most used testing frameworks for .NET as well as
<a href="https://fakeiteasy.github.io/">FakeItEasy</a> for mocking. In the end I will also use <a href="https://dotnetfoundation.org/projects/coverlet">Coverlet</a>
and <a href="https://about.codecov.io/">Codecov</a> for coverage reports.</p>
<p>The API will be the weather forecast template with the addition of a service layer which is what we will be testing. Let's get started!</p>
<h2 id="coding"><a class="anchor" href="#coding" aria-label="Anchor link for: coding">Coding</a></h2>
<h3 id="creating-the-project"><a class="anchor" href="#creating-the-project" aria-label="Anchor link for: creating-the-project">Creating the project</a></h3>
<p>I will be creating a solution with 2 projects, one being the API and the other one being the one for testing.</p>
<p>We start by creating a folder for the solution:</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">mkdir</span><span> TestingAPI
</span><span style="color:#f07178;">cd</span><span> TestingAPI
</span><span style="color:#ffb454;">dotnet</span><span> new sln
</span></code></pre>
<p>We can now create the API project and add it to our solution:</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">dotnet</span><span> new webapi</span><span style="color:#f29718;"> -n</span><span> src
</span><span style="color:#ffb454;">dotnet</span><span> sln add src/src.csproj
</span></code></pre>
<p>Similarly for our test project:</p>
<pre data-lang="bash" style="background-color:#0f1419;color:#bfbab0;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb454;">dotnet</span><span> new xunit</span><span style="color:#f29718;"> -n</span><span> test
</span><span style="color:#ffb454;">dotnet</span><span> sln add test/test.csproj
</span></code></pre>
<p>Running <code>dotnet run --project src</code> should spin up the server and sure enough, visiting <code>https://localhost:5001/weatherforecast</code>
returns us the expected responce.</p>
<h3 id="creating-the-service"><a class="anchor" href="#creating-the-service" aria-label="Anchor link for: creating-the-service">Creating the service</a></h3>
<p>I will create a <code>Services</code> folder and inside it add 2 files: a service interface and its implementation</p>
<pre data-lang="cs" style="background-color:#0f1419;color:#bfbab0;" class="language-cs "><code class="language-cs" data-lang="cs"><span style="font-style:italic;color:#5c6773;">// IMyDependency.cs
</span><span style="color:#ff7733;">using </span><span>System</span><span style="color:#bfbab0cc;">.</span><span>Threading</span><span style="color:#bfbab0cc;">.</span><span>Tasks</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">namespace </span><span style="color:#59c2ff;">src</span><span style="color:#bfbab0cc;">.</span><span style="color:#59c2ff;">Services
</span><span>{
</span><span>    </span><span style="color:#ff7733;">public interface </span><span style="color:#59c2ff;">IMyDependency
</span><span>    {
</span><span>        </span><span style="font-style:italic;color:#39bae6;">Task</span><span>&lt;</span><span style="color:#ff7733;">string</span><span>&gt; </span><span style="color:#ffb454;">GetDataFromDatabaseAsync</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>    }
</span><span>}
</span></code></pre>
<pre data-lang="cs" style="background-color:#0f1419;color:#bfbab0;" class="language-cs "><code class="language-cs" data-lang="cs"><span style="font-style:italic;color:#5c6773;">// MyDependency.cs
</span><span style="color:#ff7733;">using </span><span>System</span><span style="color:#bfbab0cc;">.</span><span>Threading</span><span style="color:#bfbab0cc;">.</span><span>Tasks</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">namespace </span><span style="color:#59c2ff;">src</span><span style="color:#bfbab0cc;">.</span><span style="color:#59c2ff;">Services
</span><span>{
</span><span>    </span><span style="color:#ff7733;">public class </span><span style="color:#59c2ff;">MyDependency</span><span style="color:#bfbab0cc;">: </span><span style="text-decoration:underline;color:#59c2ff;">IMyDependency
</span><span>    {
</span><span>        </span><span style="color:#ff7733;">public </span><span style="font-style:italic;color:#39bae6;">Task</span><span>&lt;</span><span style="color:#ff7733;">string</span><span>&gt; </span><span style="color:#ffb454;">GetDataFromDatabaseAsync</span><span>()
</span><span>        {
</span><span>            </span><span style="color:#ff7733;">return </span><span>Task</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">FromResult</span><span>(</span><span style="color:#c2d94c;">&quot;Hello From MyDependency!&quot;</span><span>)</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>Let's head to our controller and make use of the service we just created there so we can make sure it works:</p>
<pre data-lang="cs" style="background-color:#0f1419;color:#bfbab0;" class="language-cs "><code class="language-cs" data-lang="cs"><span style="font-style:italic;color:#5c6773;">// WeatherForecastController.cs
</span><span style="font-style:italic;color:#5c6773;">// ...
</span><span style="color:#ff7733;">private </span><span style="font-style:italic;color:#39bae6;">readonly </span><span>ILogger&lt;WeatherForecastController</span><span style="color:#f29668;">&gt; </span><span>_logger</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">private </span><span style="font-style:italic;color:#39bae6;">readonly </span><span>IMyDependency _dependency</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">public </span><span style="color:#ffb454;">WeatherForecastController</span><span>(ILogger</span><span style="color:#f29668;">&lt;</span><span>WeatherForecastController</span><span style="color:#f29668;">&gt; </span><span>logger</span><span style="color:#bfbab0cc;">, </span><span>IMyDependency dependency)
</span><span>{
</span><span>    _logger </span><span style="color:#f29668;">= </span><span>logger</span><span style="color:#bfbab0cc;">;
</span><span>    _dependency </span><span style="color:#f29668;">= </span><span>dependency</span><span style="color:#bfbab0cc;">;
</span><span>}
</span><span style="font-style:italic;color:#5c6773;">// ...
</span><span>
</span><span style="color:#bfbab0cc;">[</span><span style="color:#ffb454;">HttpGet</span><span style="color:#bfbab0cc;">]
</span><span style="color:#ff7733;">public </span><span style="font-style:italic;color:#39bae6;">async </span><span>Task&lt;IEnumerable&lt;WeatherForecast</span><span style="color:#f29668;">&gt;&gt; </span><span style="color:#ffb454;">Get</span><span>()
</span><span>{
</span><span>    _logger</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">LogInformation</span><span>(</span><span style="color:#ff7733;">await </span><span>_dependency</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">GetDataFromDatabaseAsync</span><span>())</span><span style="color:#bfbab0cc;">;
</span><span>    
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// No changes below this
</span><span>    </span><span style="color:#ff7733;">var </span><span>rng </span><span style="color:#f29668;">= new </span><span style="font-style:italic;color:#39bae6;">Random</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ff7733;">return </span><span>Enumerable</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Range</span><span>(</span><span style="color:#f29718;">1</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">5</span><span>)</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Select</span><span>(</span><span style="color:#f29718;">index </span><span style="color:#ff7733;">=&gt; </span><span style="color:#f29668;">new </span><span style="font-style:italic;color:#39bae6;">WeatherForecast
</span><span>    {
</span><span>        Date </span><span style="color:#f29668;">= </span><span>DateTime</span><span style="color:#f29668;">.</span><span>Now</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">AddDays</span><span>(index)</span><span style="color:#bfbab0cc;">,
</span><span>        TemperatureC </span><span style="color:#f29668;">= </span><span>rng</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Next</span><span>(</span><span style="color:#f29668;">-</span><span style="color:#f29718;">20</span><span style="color:#bfbab0cc;">, </span><span style="color:#f29718;">55</span><span>)</span><span style="color:#bfbab0cc;">,
</span><span>        Summary </span><span style="color:#f29668;">= </span><span>Summaries[rng</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Next</span><span>(Summaries</span><span style="color:#f29668;">.</span><span>Length)]
</span><span>    })
</span><span>    </span><span style="color:#f29668;">.</span><span style="color:#ffb454;">ToArray</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>}
</span></code></pre>
<p>Lastly we head to <code>Startup.cs</code> to register the implementation</p>
<pre data-lang="cs" style="background-color:#0f1419;color:#bfbab0;" class="language-cs "><code class="language-cs" data-lang="cs"><span style="font-style:italic;color:#5c6773;">// Startup.cs
</span><span style="color:#ff7733;">public void </span><span style="color:#ffb454;">ConfigureServices</span><span>(</span><span style="font-style:italic;color:#39bae6;">IServiceCollection </span><span style="color:#f29718;">services</span><span>)
</span><span>{
</span><span>    services</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">AddScoped</span><span>&lt;</span><span style="font-style:italic;color:#39bae6;">IMyDependency</span><span style="color:#bfbab0cc;">, </span><span style="font-style:italic;color:#39bae6;">MyDependency</span><span>&gt;()</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="font-style:italic;color:#5c6773;">// ...
</span><span>}
</span></code></pre>
<p>If we now run the app and hit the endpoint we should see <code>Hello From MyDependency!</code> logged in the console.</p>
<h3 id="writing-our-tests"><a class="anchor" href="#writing-our-tests" aria-label="Anchor link for: writing-our-tests">Writing our tests</a></h3>
<p>Let's navigate to our test project and write our first test</p>
<pre data-lang="cs" style="background-color:#0f1419;color:#bfbab0;" class="language-cs "><code class="language-cs" data-lang="cs"><span style="font-style:italic;color:#5c6773;">// UnitTest1.cs
</span><span style="color:#ff7733;">using </span><span>System</span><span style="color:#bfbab0cc;">.</span><span>Threading</span><span style="color:#bfbab0cc;">.</span><span>Tasks</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">using </span><span>FakeItEasy</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">using </span><span>src</span><span style="color:#bfbab0cc;">.</span><span>Services</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">using </span><span>Xunit</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">namespace </span><span style="color:#59c2ff;">test
</span><span>{
</span><span>    </span><span style="color:#ff7733;">public class </span><span style="color:#59c2ff;">UnitTest1
</span><span>    {
</span><span>        </span><span style="color:#bfbab0cc;">[</span><span style="color:#ffb454;">Fact</span><span style="color:#bfbab0cc;">]
</span><span>        </span><span style="color:#ff7733;">public async </span><span style="font-style:italic;color:#39bae6;">Task </span><span style="color:#ffb454;">Test1</span><span>()
</span><span>        {
</span><span>            </span><span style="color:#ff7733;">var </span><span>myDependency </span><span style="color:#f29668;">= new </span><span style="font-style:italic;color:#39bae6;">MyDependency</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>            Assert</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Equal</span><span>(</span><span style="color:#c2d94c;">&quot;Hello From MyDependency!&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#ff7733;">await </span><span>myDependency</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">GetDataFromDatabaseAsync</span><span>())</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>Here I changed the return type from <code>void</code> to <code>async Task</code> since the method we want to test is async. Running the test with
<code>dotnet test</code> passes but this is not what we want.</p>
<p>In a normal project this method could require a database connection that we probably do not want to make use of in our tests for various reasons.
This is where mocking comes into play; we can provide a fake implementation to our service methods. It might not be as apparent here why this could
be useful so let me explain.</p>
<p>Usually the way I like to structure my apps is to split them into 3 layers</p>
<ul>
<li>Controllers: handle http requests, call service layer</li>
<li>Services: business logic, call repository layer</li>
<li>Repositories: Handle database queries</li>
</ul>
<p>Coming from a Spring Boot background, my terminology might be a bit different than what is normally used for .NET projects but the idea is the same;
split your logic into layers and use dependency injection to interact between them.</p>
<p>The most important layer to test is the service layer since that's where all the actual "programming" is. In order to test that I would have to mock
my repository interface and have it return arbitrary fake data without actually using the database. You can imagine how bad of an idea it would be
if someone was to test creations, updates or deletions while using the actual database...</p>
<p>There are some other options such as using a different, in memory database for testing but we will not be covering that in this post.</p>
<p>So back to our test, how do we mock the dependency?</p>
<pre data-lang="cs" style="background-color:#0f1419;color:#bfbab0;" class="language-cs "><code class="language-cs" data-lang="cs"><span style="font-style:italic;color:#5c6773;">// UnitTest1.cs
</span><span style="color:#ff7733;">using </span><span>System</span><span style="color:#bfbab0cc;">.</span><span>Threading</span><span style="color:#bfbab0cc;">.</span><span>Tasks</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">using </span><span>FakeItEasy</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">using </span><span>src</span><span style="color:#bfbab0cc;">.</span><span>Services</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">using </span><span>Xunit</span><span style="color:#bfbab0cc;">;
</span><span>
</span><span style="color:#ff7733;">namespace </span><span style="color:#59c2ff;">test
</span><span>{
</span><span>    </span><span style="color:#ff7733;">public class </span><span style="color:#59c2ff;">UnitTest1
</span><span>    {
</span><span>        </span><span style="color:#bfbab0cc;">[</span><span style="color:#ffb454;">Fact</span><span style="color:#bfbab0cc;">]
</span><span>        </span><span style="color:#ff7733;">public async </span><span style="font-style:italic;color:#39bae6;">Task </span><span style="color:#ffb454;">Test1</span><span>()
</span><span>        {
</span><span>            </span><span style="color:#ff7733;">var </span><span>myDependency </span><span style="color:#f29668;">= new </span><span style="font-style:italic;color:#39bae6;">MyDependency</span><span>()</span><span style="color:#bfbab0cc;">;
</span><span>            Assert</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Equal</span><span>(</span><span style="color:#c2d94c;">&quot;Hello From MyDependency!&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#ff7733;">await </span><span>myDependency</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">GetDataFromDatabaseAsync</span><span>())</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>        
</span><span>        </span><span style="color:#bfbab0cc;">[</span><span style="color:#ffb454;">Fact</span><span style="color:#bfbab0cc;">]
</span><span>        </span><span style="color:#ff7733;">public async </span><span style="font-style:italic;color:#39bae6;">Task </span><span style="color:#ffb454;">Test2</span><span>()
</span><span>        {
</span><span>            </span><span style="color:#ff7733;">var </span><span>myDependency </span><span style="color:#f29668;">= </span><span>A</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Fake</span><span>&lt;</span><span style="font-style:italic;color:#39bae6;">IMyDependency</span><span>&gt;()</span><span style="color:#bfbab0cc;">;
</span><span>            A</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">CallTo</span><span>(() </span><span style="color:#ff7733;">=&gt; </span><span>myDependency</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">GetDataFromDatabaseAsync</span><span>())</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Returns</span><span>(Task</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">FromResult</span><span>(</span><span style="color:#c2d94c;">&quot;Hello from mocked&quot;</span><span>))</span><span style="color:#bfbab0cc;">;
</span><span>            
</span><span>            Assert</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">Equal</span><span>(</span><span style="color:#c2d94c;">&quot;Hello from mocked&quot;</span><span style="color:#bfbab0cc;">, </span><span style="color:#ff7733;">await </span><span>myDependency</span><span style="color:#f29668;">.</span><span style="color:#ffb454;">GetDataFromDatabaseAsync</span><span>())</span><span style="color:#bfbab0cc;">;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>Using the <code>FakeItEasy</code> package we define an instance of the <code>IMyDependency</code> interface using <code>A.Fake</code>. This right now does nothing;
we have to explicitly define what happens when one of the interface methods gets called, we do that with <code>A.CallTo</code>  which accepts a lambda
of the method in question. I am using <code>Task.FromResult</code> because the method is async. If we run the test we can see that it passes which means that
we successfully changed the "implementation" of our dependency. Again, this is what would normally be a repository and a database call changed to
hard coded data, similar to what would be returned from said database call.</p>
<h3 id="adding-a-ci-pipeline-with-codecov"><a class="anchor" href="#adding-a-ci-pipeline-with-codecov" aria-label="Anchor link for: adding-a-ci-pipeline-with-codecov">Adding a CI pipeline with Codecov</a></h3>
<p>Another thing we could do is add Codecov to get a detailed view of our test coverage. The best way to do that in my
opinion is to create a Continuous Integration (CI) pipeline on Github that will generate and push code coverage information everytime we update
the repository.</p>
<p>First go to Codecov's website and create an account. Get your <code>CODECOV_TOKEN</code> and create a repository secret with its value on your github
repository, we will be using this later when we push our data to Codecov.</p>
<p>We also need to create a <code>codecov.yml</code> file with some basic configuration. Here's what I had from a previous project:</p>
<pre data-lang="yml" style="background-color:#0f1419;color:#bfbab0;" class="language-yml "><code class="language-yml" data-lang="yml"><span style="font-style:italic;color:#5c6773;">## codecov.yml
</span><span style="color:#59c2ff;">comment</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">false
</span><span>
</span><span style="color:#59c2ff;">ignore</span><span style="color:#bfbab0cc;">:
</span><span>  - </span><span style="color:#c2d94c;">&quot;^(?!.*Services).*$&quot;
</span><span>
</span><span style="color:#59c2ff;">coverage</span><span style="color:#bfbab0cc;">:
</span><span>  </span><span style="color:#59c2ff;">status</span><span style="color:#bfbab0cc;">:
</span><span>    </span><span style="color:#59c2ff;">project</span><span style="color:#bfbab0cc;">:
</span><span>      </span><span style="color:#59c2ff;">default</span><span style="color:#bfbab0cc;">:
</span><span>        </span><span style="color:#59c2ff;">target</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">auto
</span><span>        </span><span style="color:#59c2ff;">threshold</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">1%
</span><span>        </span><span style="color:#59c2ff;">informational</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">true
</span><span>    </span><span style="color:#59c2ff;">patch</span><span style="color:#bfbab0cc;">:
</span><span>      </span><span style="color:#59c2ff;">default</span><span style="color:#bfbab0cc;">:
</span><span>        </span><span style="color:#59c2ff;">target</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">auto
</span><span>        </span><span style="color:#59c2ff;">threshold</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">1%
</span><span>        </span><span style="color:#59c2ff;">informational</span><span style="color:#bfbab0cc;">: </span><span style="color:#f29718;">true
</span></code></pre>
<p>The only interesting thing about this is that I ignored every folder that does not include <code>Services</code> since that's the only thing we tested.</p>
<p>Let's create the <code>.github/workflows/dotnet.yml</code> file and use the Github Actions template for .NET apps which includes building and testing.
We only have to add one more step for codecov to work:</p>
<pre data-lang="yml" style="background-color:#0f1419;color:#bfbab0;" class="language-yml "><code class="language-yml" data-lang="yml"><span style="font-style:italic;color:#5c6773;">## dotnet.yml
</span><span style="color:#59c2ff;">name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">.NET
</span><span>
</span><span style="color:#f29718;">on</span><span style="color:#bfbab0cc;">:
</span><span>  </span><span style="color:#59c2ff;">push</span><span style="color:#bfbab0cc;">:
</span><span>    </span><span style="color:#59c2ff;">branches</span><span style="color:#bfbab0cc;">: </span><span>[ </span><span style="color:#c2d94c;">master </span><span>]
</span><span>  </span><span style="color:#59c2ff;">pull_request</span><span style="color:#bfbab0cc;">:
</span><span>    </span><span style="color:#59c2ff;">branches</span><span style="color:#bfbab0cc;">: </span><span>[ </span><span style="color:#c2d94c;">master </span><span>]
</span><span>
</span><span style="color:#59c2ff;">jobs</span><span style="color:#bfbab0cc;">:
</span><span>  </span><span style="color:#59c2ff;">build</span><span style="color:#bfbab0cc;">:
</span><span>
</span><span>    </span><span style="color:#59c2ff;">runs-on</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">ubuntu-latest
</span><span>
</span><span>    </span><span style="color:#59c2ff;">steps</span><span style="color:#bfbab0cc;">:
</span><span>    - </span><span style="color:#59c2ff;">uses</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">actions/checkout@v2
</span><span>    - </span><span style="color:#59c2ff;">name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">Setup .NET
</span><span>      </span><span style="color:#59c2ff;">uses</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">actions/setup-dotnet@v1
</span><span>      </span><span style="color:#59c2ff;">with</span><span style="color:#bfbab0cc;">:
</span><span>        </span><span style="color:#59c2ff;">dotnet-version</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">5.0.x
</span><span>    - </span><span style="color:#59c2ff;">name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">Restore dependencies
</span><span>      </span><span style="color:#59c2ff;">run</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">dotnet restore
</span><span>    - </span><span style="color:#59c2ff;">name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">Build
</span><span>      </span><span style="color:#59c2ff;">run</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">dotnet build --no-restore
</span><span>    - </span><span style="color:#59c2ff;">name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">Test
</span><span>      </span><span style="color:#59c2ff;">run</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">dotnet test --no-build --verbosity normal --collect:&quot;XPlat Code Coverage&quot; -- IncludeDirectory=&quot;[.]*Services[.]*&quot;
</span><span>    - </span><span style="color:#59c2ff;">name</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">Codecov
</span><span>      </span><span style="color:#59c2ff;">uses</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">codecov/codecov-action@v2
</span><span>      </span><span style="color:#59c2ff;">with</span><span style="color:#bfbab0cc;">:
</span><span>        </span><span style="color:#59c2ff;">token</span><span style="color:#bfbab0cc;">: </span><span style="color:#c2d94c;">${{ secrets.CODECOV_TOKEN }}
</span></code></pre>
<p>The <a href="https://github.com/codecov/codecov-action">Codecov action</a> offers a few useful parameters for you to use so if you are interested,
read their docs!</p>
<p>With all this done and pushed you just want to wait for the Action to complete. After that's done I can take a look at my coverage</p>
<p><img src="https://antoniosbarotsis.github.io/posts/aspnet_testing/images/codecov.png#center" alt="codecov" /></p>
<p>This is very useful to look at when dealing when <em>more than one directory unlike here</em>.</p>
<p>You can also take a look at the exact spots in your code that you tested/missed</p>
<p><img src="https://antoniosbarotsis.github.io/posts/aspnet_testing/images/code.png#center" alt="code" /></p>
<p>And finally (but certainly most importantly), codecov gives you a badge to display on your Github repo to show everyone how well tested your code
is. What's the point of testing if you don't let everyone know you did after all?</p>
<h2 id="conclusion"><a class="anchor" href="#conclusion" aria-label="Anchor link for: conclusion">Conclusion</a></h2>
<p>Testing is basically essential to any application that is not yet another personal project doomed to be abandoned a few weeks after its inception.
If you decide to test your project I do not see why you wouldn't include coverage reports, whether automated or not. Codecov (and other similar tools)
allow you to set a lot of rules that would fail your pipeline if not met such as: minimum coverage, a minimum threshold of allowed coverage drop on new
commits and a lot more.</p>
<p>I hope you got something out of this post and thanks for reading! :)</p>
<p>You can find the code <a href="https://github.com/AntoniosBarotsis/TestingAPI">here</a>.</p>

</div>

        
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read more</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        <span class="button previous">
            <a href="https://antoniosbarotsis.github.io/posts/zip_it_and_ship_it/">
                <span class="button__icon">←</span>&nbsp;
                <span class="button__text">Zip it and ship it!</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://antoniosbarotsis.github.io/posts/cs_elk/">
                <span class="button__text">C# and the ELK stack</span>&nbsp;
                <span class="button__icon">→</span>
            </a>
        </span>
        </div>
</div>

<script src="https://utteranc.es/client.js" repo="AntoniosBarotsis/antoniosbarotsis.github.io" issue-term="pathname"
    label="Comment" theme="github-dark" crossorigin="anonymous" async>
    </script>


    </div>


    </div>
    
    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2025
 Powered by <a href="https://www.getzola.org/">Zola</a></span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
